{% extends 'core/adminlte/admin_layout.html' %}

{% block content %}
<!-- Список фильмов текущих -->
<div class="card shadow-sm mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title mb-0">Сейчас в кино</h3>
    <form method="post" class="m-0">
        {% csrf_token %}
        <button name="action" value="add_now_showing" type="submit" class="btn btn-outline-success btn-sm">
          <i class="fa fa-plus"></i> Добавить фильм
        </button>
    </form>
  </div>
  <div class="card-body">
    <div class="row g-4">
      {% for film in now_showing_films %}
      <div class="col-6 col-sm-4 col-md-3">
        <div class="text-center position-relative">
          <!-- КНОПКА УДАЛЕНИЯ -->
          <form method="post" class="position-absolute top-0 end-0 m-1" style="z-index: 10;">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_film">
              <input type="hidden" name="film_id" value="{{ film.pk }}">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите удалить фильм «{{ film.title }}»?');">
                  <i class="fas fa-trash"></i>
              </button>
          </form>

          <a href="{% url 'core:edit_film' film.pk %}" class="d-block text-decoration-none text-dark">
            <div class="bg-light border rounded d-flex align-items-center justify-content-center mb-2" style="height:180px;">
              {% if film.main_image %}
                <img src="{{ film.main_image.url }}" alt="{{ film.title }}" style="width: 100%; height: 100%; object-fit: cover;">
              {% else %}
                <i class="fa-solid fa-image fa-3x text-muted"></i>
              {% endif %}
            </div>
            <p class="mb-0">{{ film.title }}</p>
          </a>
        </div>
      </div>
      {% empty %}
        <p class="text-muted">Фильмов в прокате нет.</p>
      {% endfor %}
    </div>
  </div>
<!-- БЛОК ПАГИНАЦИИ ДЛЯ "СЕЙЧАС В КИНО" -->
      <div class="card-footer clearfix">
        {% if now_showing_films.has_other_pages %}
          <ul class="pagination pagination-sm m-0 float-end">
            <!-- Кнопка "Назад" -->
            {% if now_showing_films.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page_now={{ now_showing_films.previous_page_number }}{% if request.GET.page_soon %}&page_soon={{ request.GET.page_soon }}{% endif %}">&laquo;</a>
              </li>
            {% else %}
              <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
            {% endif %}

            <!-- Ссылки на страницы -->
            {% for num in now_showing_films.paginator.page_range %}
              <li class="page-item {% if now_showing_films.number == num %}active{% endif %}">
                <a class="page-link" href="?page_now={{ num }}{% if request.GET.page_soon %}&page_soon={{ request.GET.page_soon }}{% endif %}">{{ num }}</a>
              </li>
            {% endfor %}

            <!-- Кнопка "Вперед" -->
            {% if now_showing_films.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page_now={{ now_showing_films.next_page_number }}{% if request.GET.page_soon %}&page_soon={{ request.GET.page_soon }}{% endif %}">&raquo;</a>
              </li>
            {% else %}
              <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
            {% endif %}
          </ul>
        {% endif %}
      </div>
</div>




<!-- Список фильмов "скоро" -->
<div class="card shadow-sm mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title mb-0">Скоро в прокате</h3>
    <form method="post" class="m-0">
        {% csrf_token %}
        <button name="action" value="add_coming_soon" type="submit" class="btn btn-outline-success btn-sm">
          <i class="fa fa-plus"></i> Добавить фильм
        </button>
    </form>
  </div>
  <div class="card-body">
    <div class="row g-4">
      {% for film in coming_soon_films %}
      <div class="col-6 col-sm-4 col-md-3">
        <!-- ИЗМЕНЕНИЕ 2: Добавляем position-relative и здесь -->
        <div class="text-center position-relative">

          <!-- НОВАЯ КНОПКА УДАЛЕНИЯ -->
          <form method="post" class="position-absolute top-0 end-0 m-1" style="z-index: 10;">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_film">
              <input type="hidden" name="film_id" value="{{ film.pk }}">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите удалить фильм «{{ film.title }}»?');">
                  <i class="fas fa-trash"></i>
              </button>
          </form>
          <!-- КОНЕЦ НОВОЙ КНОПКИ -->

          <a href="{% url 'core:edit_film' film.pk %}" class="d-block text-decoration-none text-dark">
            <div class="bg-light border rounded d-flex align-items-center justify-content-center mb-2" style="height:180px;">
              {% if film.main_image %}
                <img src="{{ film.main_image.url }}" alt="{{ film.title }}" style="width: 100%; height: 100%; object-fit: cover;">
              {% else %}
                <i class="fa-solid fa-image fa-3x text-muted"></i>
              {% endif %}
            </div>
            <p class="mb-0">{{ film.title }}</p>
          </a>
        </div>
      </div>
      {% empty %}
        <p class="text-muted">Фильмов в категории "скоро" нет.</p>
      {% endfor %}
    </div>
  </div>
    <!-- БЛОК ПАГИНАЦИИ ДЛЯ "СКОРО В ПРОКАТЕ" -->
      <div class="card-footer clearfix">
        {% if coming_soon_films.has_other_pages %}
          <ul class="pagination pagination-sm m-0 float-end">
            <!-- Кнопка "Назад" -->
            {% if coming_soon_films.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page_soon={{ coming_soon_films.previous_page_number }}{% if request.GET.page_now %}&page_now={{ request.GET.page_now }}{% endif %}">&laquo;</a>
              </li>
            {% else %}
              <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
            {% endif %}

            <!-- Ссылки на страницы -->
            {% for num in coming_soon_films.paginator.page_range %}
              <li class="page-item {% if coming_soon_films.number == num %}active{% endif %}">
                <a class="page-link" href="?page_soon={{ num }}{% if request.GET.page_now %}&page_now={{ request.GET.page_now }}{% endif %}">{{ num }}</a>
              </li>
            {% endfor %}

            <!-- Кнопка "Вперед" -->
            {% if coming_soon_films.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page_soon={{ coming_soon_films.next_page_number }}{% if request.GET.page_now %}&page_now={{ request.GET.page_now }}{% endif %}">&raquo;</a>
              </li>
            {% else %}
              <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
            {% endif %}
          </ul>
        {% endif %}
      </div>
</div>
{% endblock %}